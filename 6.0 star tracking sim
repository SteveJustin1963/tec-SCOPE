\ Define 16-bit fixed-point number format
16 CONSTANT FP-SIZE
65536 CONSTANT FP-MAX

\ Constants for simulated star positions in fixed-point format
10000 CONSTANT STAR-X  \ Simulated X position of the star
20000 CONSTANT STAR-Y  \ Simulated Y position of the star

\ Variables to represent the sensors' current detection positions
VARIABLE SENSOR-X1
VARIABLE SENSOR-X2
VARIABLE SENSOR-Y1
VARIABLE SENSOR-Y2

\ Initialize sensor variables
0 SENSOR-X1 !
0 SENSOR-X2 !
0 SENSOR-Y1 !
0 SENSOR-Y2 !

\ Variables to represent the telescope's current pointing position
VARIABLE TELESCOPE-X  \ Initial X position of the telescope (0)
VARIABLE TELESCOPE-Y  \ Initial Y position of the telescope (0)

\ Initialize telescope position
0 TELESCOPE-X !
0 TELESCOPE-Y !

\ Function to simulate detecting the position of a moving point of light
: SIMULATE-DETECT-STAR-POSITION ( -- )
  STAR-X SENSOR-X1 @ - SENSOR-X1 !
  STAR-X SENSOR-X2 @ - SENSOR-X2 !
  STAR-Y SENSOR-Y1 @ - SENSOR-Y1 !
  STAR-Y SENSOR-Y2 @ - SENSOR-Y2 ! ;

\ Function to calculate average from sensor readings
: AVERAGE-SENSOR ( sensor1 sensor2 -- average )
  + 2 / ;

\ Function to update the telescope's pointing position based on sensor readings
: UPDATE-TELESCOPE-POSITION ( -- )
  SENSOR-X1 @ SENSOR-X2 @ AVERAGE-SENSOR TELESCOPE-X +!
  SENSOR-Y1 @ SENSOR-Y2 @ AVERAGE-SENSOR TELESCOPE-Y +! ;

\ Main star tracking loop with a fixed number of iterations for simulation
: STAR-TRACKER-SIMULATION ( -- )
  100 0 DO  \ Simulate 100 cycles
    SIMULATE-DETECT-STAR-POSITION      \ Simulate detecting the star's position
    UPDATE-TELESCOPE-POSITION          \ Update the telescope's pointing position
  LOOP ;

\ Start the star tracker simulation
STAR-TRACKER-SIMULATION

\ Output the result of the simulation
TELESCOPE-X @ . CR
TELESCOPE-Y @ . CR
